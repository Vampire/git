#!/bin/sh

describe() {
  if v=`git describe --exact-match HEAD 2>/dev/null`; then
    echo $v
  elif v=`git describe --exact-match --all HEAD 2>/dev/null`; then
    # dereference symbolic links
    shorten `git rev-parse --symbolic-full-name "$v"`
  else
    echo test
  fi
}

shorten() {
  case "$1" in
    refs/heads/*) echo "${1#refs/heads/}" ;;
  refs/remotes/*) echo "$1"  | sed 's,refs/remotes/[^/]*/,,' ;;
               *) echo "$1" ;;
  esac
}

describe | tr / .
exit 0
